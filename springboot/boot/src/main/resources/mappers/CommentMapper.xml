<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.hi.boot.dao.CommentDAO">
    <resultMap type="Comment" id="commentMap">
        <id property="num" column="co_num" />
        <result property="content" column="co_content"/>
        <result property="date" column="co_date"/>
        <result property="id" column="co_me_id"/>
        <result property="oriNum" column="co_ori_num"/>
        <result property="del" column="co_del"/>
        <result property="postNum" column="co_po_num"/>
    </resultMap>
    <insert id="insertComment">
        insert into comment (co_num, co_ori_num, co_me_id, co_content)
        select ifnull(max(co_num), 0 + 1,
               ifnull (max(co_num), 0 + 1,
               #{comment.id},
               #{comment.content},
               #{comment.postNum}
        from comment
    </insert>
    <delete id="deleteComment">
        update comment
        set co_del = 'Y'
        where co_num = #{coNum}
    </delete>
    <select id="selectComments" resultMap="commentMap">
        select * from comment
        where co_po_num = #{num} and co_del = 'N'
        order by co_ori_num desc, co_num asc
        limit #{cri.pageStart}, #{cri.perPageNum}
    </select>
    <select id="selectCommentsCount" resultType="java.lang.Integer">
        select count(*)
        from comment
        where
        co_po_num = #{num}
    </select>
    <select id="selectComment" resultMap="commentMap">
        select * from comment where co_num = #{coNum}
    </select>
</mapper>