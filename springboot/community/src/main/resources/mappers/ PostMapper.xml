<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.hi.community.dao.PostDAO">
    <insert id="insertPost">
        insert into post (po_me_id, po_bo_num, po_title, po_content)
        values (#{post.writer}, #{post.board}, #{post.title}, #{post.content})
    </insert>
    <insert id="insertBoard">
        insert into board (bo_name)
        values (#{boName})
    </insert>
    <update id="updateView">
        update post
        <!-- 조회수 증가 -->
        set po_view = po_view + 1
        where po_num = #{num}
        <!-- 삭제 안된 게시글 -->
        and po_del = 'N'
    </update>
    <update id="updateBoard">
        update board
        set
            bo_name = #{name}
        where
            bo_num = #{num}
    </update>
    <update id="updatePost">
        update post
        set po_content = #{post.content}
        where po_num = #{num}
    </update>

    <delete id="deletePost">
        update post
        set po_del = 'Y'
        where po_num = #{num}
    </delete>
    <delete id="deleteBoard">
        delete from board
        where bo_num = #{num}
    </delete>
    <!--
    id에는 dao의 메서드명을 입력. 오타 발생시 예외가 발생
    ~~~(not found) 예외 발생
    -->
    <select id="selectPostList" resultType="kr.hi.community.model.vo.PostVO">
        select post.*, bo_name po_bo_name from post
        join board on po_bo_num = bo_num
        <!-- 삭제 안된 게시글을 조회 -->
        where po_del = 'N'
        <!-- 전체 게시판이 아닌 경우  -->
        <if test="cri.boardNum != 0">
            and po_bo_num = #{cri.boardNum}
        </if>
        <if test="cri.type == 1">
            and ( po_title like concat('%', #{cri.search}, '%')
            or po_content like concat('%', #{cri.search}, '%'))
        </if>
        <if test="cri.type == 2" >
            and po_me_id = #{cri.search}
        </if>
        <if test="cri.type == 0">
            and (po_title like concat('%', #{cri.search}, '%')
            or po_content like concat('%', #{cri.search}, '%')
            or po_me_id = #{cri.search})
        </if>
        <!-- 최신 게시글이 위에 가도록 정렬 -->
        order by po_num desc
        <!-- cri.pageStart하면 실제로는 cri.getPageStart() 호출 -->
        limit #{cri.pageStart}, #{cri.perPageNum}
    </select>
    <select id="selectPost" resultType="kr.hi.community.model.vo.PostVO">
        select * from post
        where po_num = #{num}
        and po_del = 'N'
    </select>
    <select id="selectBoardList" resultType="kr.hi.community.model.vo.BoardVO">
        select * from board
    </select>
    <select id="selectTotalCount" resultType="java.lang.Integer">
        select count(*) from post
        where po_del = 'N'
        <if test="cri.boardNum != 0">
            and po_bo_num = #{cri.boardNum}
        </if>
        <if test="cri.type == 1">
            and (po_title like concat('%', #{cri.search}, '%')
            or po_content like concat('%', #{cri.search}, '%'))
        </if>
        <if test="cri.type == 2" >
            and po_me_id = #{cri.search}
        </if>
        <if test="cri.type == 0">
            and (po_title like concat('%', #{cri.search}, '%')
            or po_content like concat('%', #{cri.search}, '%')
            or po_me_id = #{cri.search})
        </if>
    </select>
</mapper>