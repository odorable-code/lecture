<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

	<!-- í°íŠ¸ì–´ì¸ -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
	<style>
		body {
			background: #F6F7FB;
		}
		.list {
			list-style: none; padding: 0;
		}
		.list li {
			display: flex;
			margin-bottom: 10px;
			padding: 20px;
			justify-content: space-between;
			background: white;
			border-radius: 5px;
			box-sizing: border-box;
			box-shadow: 0 5px 5px -5px;
			width: 101%;
			height: 100%;
		}
		.btn-del {
			font-size: medium; 
			color: #AEB1B5;
		}
		textarea {
			height: 130px;
		}
		.outer-timebox {
			display: flex;
			height: calc(100%+10px);
			flex-direction: column;
			justify-content: space-between;
			align-items: flex-end;
		}
		.creation-time {
			color: gray;
			font-size: x-small;
		}
	</style>
	<script src="index.js"></script>
</head>
<body>
<header>
		<h1 class="text-center m-4">ë©”ëª¨íŒ¨ë“œğŸ“</h1>
	</header>
	<main class="container">
		<form action="" id="form" class="row mb-3">
			<div class="col-10">
				<textarea id="input" class="form-control" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
			</div>
			<button type="submit" class="btn btn-primary col-2">ì¶”ê°€</button>
		</form>
		<ul class="list">
		</ul>
	</main>
	<script>
		const btn = document.querySelector("button");
		const input = document.querySelector("#input");
		const form = document.querySelector("#form");
		const list = document.querySelector(".list");
		const TITLE = "list1";

		form.onsubmit = (e) => e.preventDefault();
		form.addEventListener("submit", (e) =>e.preventDefault());

		btn.addEventListener("click", addItem);

		document.addEventListener("DOMContentLoaded", ()=> {
			loadLocalStorage();
			drawEmpty();
		})

		function drawEmpty(){
			if(list.querySelectorAll("li").length == 0){
				list.innerHTML =`<li style="background: #F6F7FB;box-shadow:0 0 0 0;"><h3 class="text-center col-12">ë“±ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.<h3></li>`;
			}
		}
		//ì¶”ê°€
		function addItem(e){
			let text = input.value.trim();
			if(text == ""){
				alert("ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
				input.value = "";
				return;
			}
			
			text = text.replace(/\n/g, "<br>");

			if(list.querySelectorAll("li .content").length == 0){
				list.innerHTML = '';
			}
			let timeNow = new Date;
			let li = createItem(text, timeNow);
			list.append(li);

			setLiDataSet(li, text, timeNow);
			input.value = "";
			saveLocalStorage();
		}
	
		//ì‚­ì œ
		list.addEventListener("click", function(e){
			let el = e.target;
			if(el.classList.contains("btn-del")){
				el.closest("li").remove();
			}
			saveLocalStorage();
			drawEmpty();
		});

		function createItem(text, creationTime) {
			let li = document.createElement("li");
			let span = document.createElement("span");
			span.innerHTML = text;
			span.classList.add("content");
			li.append(span);

			let div = document.createElement("div");
			div.classList.add("outer-timebox");
			li.append(div);
			
			let ctime = document.createElement("span");
			ctime.classList.add("creation-time");
			ctime.textContent = formatDateTime(new Date(creationTime));

			let delBtn = document.createElement("div");
			delBtn.classList.add("btn-del");
			delBtn.textContent = "ì‚­ì œ";
			div.append(delBtn);
			div.append(ctime);
			return li;
		}

		function loadLocalStorage() {
			let memos = JSON.parse(localStorage.getItem(TITLE));
			if (!memos) {
				return;
			}
			memos.forEach(memo => {
				let li = createItem(memo.content, memo.creationTime);
				list.append(li);
			})
		}

		function saveLocalStorage(){
			let items = list.querySelectorAll("li");
			let itemList = [];
			items.forEach(item => {
				let obj = getLiDataSet(item);
				console.log(obj);
				if (obj) {
					itemList.push(obj);
				}
			});
			
			localStorage.setItem(TITLE, JSON.stringify(itemList));
		}

		function setLiDataSet(li, content, creationTime){
			let target = li.querySelector(".content");
			target.dataset.content = content;
			target.dataset.creationTime = creationTime;
		}
		function getLiDataSet(li){
			let target = li.querySelector(".content");
			if (!target) {
				return;
			}
			return Memo(target.dataset.content, target.dataset.creationTime);
		}

		function formatDateTime(date) {
			const year = date.getFullYear();
			const month = String(date.getMonth() + 1).padStart(2, '0');
			const day = String(date.getDate()).padStart(2, '0');
			const hours = String(date.getHours()).padStart(2, '0');
			const minutes = String(date.getMinutes()).padStart(2, '0');
			const seconds = String(date.getSeconds()).padStart(2, '0');

			return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
		}

	</script>
</body>
</html>